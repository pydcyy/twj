<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>用户中心</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<link rel="stylesheet" href="css/mui.min.css"/>
	<link rel="stylesheet" href="css/mui-icons-extra.css"/>
	<link rel="stylesheet" href="css/app.css" />
	<link rel="stylesheet" href="css/user.css" />
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/mui.min.js"></script>
	<script type="text/javascript" src="js/lib/artTemplate.js"></script>
	<script type="text/javascript" src="js/lib/common.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
	<style>
		
	</style>
</head>
<body>
	  <!-- 主页面容器 -->
	  <div class="mui-content mui-scroll-wrapper" id="pullrefresh">
		<!-- 主页面标题 --> 
		<header class="header">
			<div class="mui-bar mui-bar-nav" style="box-shadow: none;background: #2695EF;">
				<div class="fa fa-gear" id="setting"></div>
				<h1 class="mui-title"  style="right: 80px;left: 80px;">我的</h1>
				<div class="fa fa-more" style="float: right;font-size: 32px;" id="invite"></div>
			</div>
		</header>
		<div class="mui-scroll" style="margin-bottom: 50px;">
		  <div>
			<!-- 主界面具体展示内容 -->
			<div class="mui-content-main first-main" style="margin-top: -120px;" id="diva_wrap">
				
				<div class="useravter" id="useravter" style="background: url('http://api.tongwujie.cn/public/images/default.png');background-size:100% 100%;">
				</div>
				
				<div class="username">
					<span>通无界</span>
				</div>
				<div class="xingxi">
					<ul class="overContrl">
						<li>
							<span>0</span>
							<p>购物车</p>
						</li>
						<li id="transaction">
							<span>0</span>
							<p>交易记录</p>
						</li>
					</ul>
				</div>
			</div>
			<div class="mui-content-main">
				<div class="record">
					<span class="mui-pull-left">我的订单</span>
					<span class="mui-pull-right" id="orderlist">
						<p class="mui-icon mui-icon-forward mui-pull-right " style="font-size: 18px;"></p>
						<p class="mui-pull-right">全部订单</p>
					</span>
				</div>
				<div class="record-m">
					<ul class="overContrl orderul">
						<li data-index="1">
							<span class="mui-icon-extra mui-icon-extra-card"></span>
							<p>待付款</p>
						</li>
						<li data-index="2">
							<span class="mui-icon-extra mui-icon-extra-cart"></span>
							<p>待发货</p>
						</li>
						<li data-index="3">
							<span class="mui-icon-extra mui-icon-extra-express"></span>
							<p>待收货</p>
						</li>
					</ul>
				</div>
				<div class="record-f">
					<ul class="overContrl" id="divb_wrap">
						<li>
							<span>0.0</span>
							<p>余额</p>
						</li>
						<li>
							<span>0</span>
							<p>积分</p>
						</li>
						<li>
							<span>0</span>
							<p>金珠</p>
						</li>
						<li style="border-left:1px solid #E6E6E6 ;margin-top: -1px;" id="mywallet">
							<span class="mui-icon-extra mui-icon-extra-gold"style="font-size:20px"></span>
							<p style="margin-bottom:0;">我要充值</p>
						</li>
					</ul>
				</div>
			</div>
			<div class="mui-content-main" style="padding-top: 0;margin-bottom: 10px;">
				<ul class="list">
					<li class="mui-table-view-cell" style="padding-left: 12px;" >
						<a class="mui-navigate-right" id="referrals">
							<span class="fa fa-yaoqing"></span><span class="title"  style="margin-left: 0px;">我的邀请</span>
						</a>
					</li>
					<li class="mui-table-view-cell" style="padding-left: 12px;">
						<a class="mui-navigate-right" style="display: flex;align-items:center;" id="myteam">
							<span class="fa fa-tuandui"></span> 
							<span class="title"  style="margin-left: 0px;">我的团队</span>
						</a>
					</li>
				</ul>
			</div>
			<div class="mui-content-main" style="padding-top: 0;margin-bottom: 59px;">
				<ul class="list">
					<li class="mui-table-view-cell" id="bankcard">
						<a class="mui-navigate-right">
							<span class="mui-icon-extra mui-icon-extra-card"></span><span class="title">银行卡</span>
						</a>
					</li>
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" style="display: flex;align-items:center;" id="address">
							<span class="mui-icon mui-icon-location"></span> 
							<span class="title" >收货地址管理</span>
						</a>
					</li>
					<li class="mui-table-view-cell" style="display: flex;justify-content:space-between;"  id="phoneline">
						<div class="" style="display: flex;align-items:center;">
							<span class="mui-icon-extra mui-icon-extra-custom"></span>
							<span class="title" >联系客服</span>
						</div>	
						
						<div class="mui-pull-right" id="divc_wrap" style="color: #7d7e82;font-size: 12px;text-align: right;">
							
						</div>
						
					</li>
				</ul>
			</div>
			
		  </div>
		</div>  
		<div class="mui-off-canvas-backdrop"></div>
	  </div>
<script type="text/html" id="diva_view">
	<div class="useravter" id="useravter" style="background: url({{data.avatar}});background-size:100% 100%;">
	</div>
	<div class="username">
		<span>{{data.nickname}}</span>
	</div>
	<div class="xingxi">
		<ul class="overContrl">
			<li>
				<span>{{data.shopcartnum}}</span>
				<p>购物车</p>
			</li>
			<li>
				<span>{{data.tradenum}}</span>
				<p>交易记录</p>
			</li>
		</ul>
	</div>
</script>
<script type="text/html" id="divb_view">
	<li>
		<span>{{data.credit1}}</span>
		<p>余额</p>
	</li>
	<li>
		<span>{{data.credit2}}</span>
		<p>积分</p>
	</li>
	<li>
		<span>{{data.credit3}}</span>
		<p>金珠</p>
	</li>
	<li style="border-left:1px solid #E6E6E6 ;margin-top: -1px;" id="mywallet" data-credit='{{data.credit1}}'>
		<span class="mui-icon-extra mui-icon-extra-gold"style="font-size:20px"></span>
		<p style="margin-bottom:0;">我要充值</p>
	</li>
</script>
<script type="text/html" id="divc_view">
	<p>{{data.hotline}}</p>
</script>
<script type="text/javascript">	
	(function($, doc) {
		$.init({
			pullRefresh: {
				container: '#pullrefresh',
				down: { //下拉刷新
					callback: pulldownRefresh,
					style: $.os.android ? "circle" : "default"
				}
			}
		});
		
		function pulldownRefresh() {	
			loadData();
			appPage.endPullRefresh();
		}
		
		$.plusReady(function() {		
			var settingButton = doc.getElementById("setting");
			var addressButton = doc.getElementById("address");		
			var phonelineButton = doc.getElementById("phoneline");
			var bankcardButton = doc.getElementById("bankcard");
			var inviteButton = doc.getElementById("invite");
			var referralsButton = doc.getElementById("referrals");
			var myteamButton = doc.getElementById("myteam");
			var orderlistButton = doc.getElementById("orderlist");
			var transactionButton = doc.getElementById("transaction");

			// 去推广注册页面
			var invite = plus.webview.getWebviewById("invite");
			var invite_loaded_flag = false;
			if(!invite){
				invite = $.preload({
					"id": 'invite',
					"url": 'invite.html'
				});
			}else{
				invite_loaded_flag = true;
			}
			
			invite.addEventListener("loaded",function () {
				invite_loaded_flag = true;
			});
			var toInvite = function() {
				//使用定时器的原因：
				//可能执行太快，main页面loaded事件尚未触发就执行自定义事件，此时必然会失败
				var id = setInterval(function () {
					if(invite_loaded_flag){
						clearInterval(id);
						$.fire(invite, 'show', null);
						invite.show("pop-in");
					}
				},20);
			};
			
			
			
			inviteButton.addEventListener('tap',function(even){
				toInvite();
			})
			settingButton.addEventListener('tap',function(even){
				loginRequired(function(){
					beforeOpenView('setting.html', 'setting.html');
				})
			})
			doc.getElementById("useravter").addEventListener('tap',function(even){
				loginRequired(function(){
					beforeOpenView('setting.html', 'setting.html');
				})
			})
			
			
			addressButton.addEventListener('tap',function(even){
				loginRequired(function(){
					beforeOpenView("address.html");
				})
			})
			bankcardButton.addEventListener('tap',function(even){
				loginRequired(function(){
					beforeOpenView("bankcard.html");
				})
			})
			referralsButton.addEventListener('tap',function(even){
				loginRequired(function(){
					beforeOpenView("referrals.html");
				})
			})
			myteamButton.addEventListener('tap',function(even){
				loginRequired(function(){
					beforeOpenView("myteam.html");
				})
			})
			orderlistButton.addEventListener('tap',function(even){
				loginRequired(function(){
					beforeOpenView("orderlist.html");
				})
			})
			transaction.addEventListener('tap',function(even){
				loginRequired(function(){
					beforeOpenView("transaction.html");
				})
			})
			
			$('body').on('tap','#mywallet',function(e){
				var credit=this.getAttribute("data-credit");
				if(credit!=null){
					beforeOpenView("withdraw.html","withdraw.html",{credit:credit});
				}
			})
			$('body').on('tap','.orderul li',function(e){
				var index=this.getAttribute("data-index");
				if(index!=null){
					beforeOpenView("orderlist.html","orderlist.html",{index:index});
				}
			})
			
			loadData();
			afterOpenView();
			
		})
		
		function loadData() {	
			var url = postUrl+"Home/member/user.html";
			var postData = {};
			diyAjax(url,postData,function(result){
				console.log("获取用户中心信息");
				if(result.code == 1){
					var userinfojson = {};
					userinfojson.data = result.data.userinfo;
					
					localStorage.setItem('$UserDetailInfo', JSON.stringify(userinfojson.data));
					
					render("#diva_wrap", "diva_view", userinfojson);
					render("#divb_wrap", "divb_view", userinfojson);
					render("#divc_wrap", "divc_view", userinfojson);
					
					$("body").on("tap", "#phoneline", function() {
						var tel= userinfojson['data']['hotline'];
						plus.device.dial(tel, true);
					})
				}
			},function(xhr){
				console.log("失败"+JSON.stringify(xhr));
			})		
		}
		
		
	}(mui, document))
</script>
</body>
</html>